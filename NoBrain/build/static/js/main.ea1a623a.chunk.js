(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{31:function(e,t,n){},32:function(e,t,n){},40:function(e,t,n){e.exports=n(74)},45:function(e,t,n){},47:function(e,t,n){},49:function(e,t,n){},51:function(e,t,n){},53:function(e,t,n){},55:function(e,t,n){},57:function(e,t,n){},72:function(e,t,n){},74:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(34),i=n.n(r),u=(n(45),n(21)),l=n(2),o=n(22),s=n(16),m=n(14);n(47),n(49),n(51);var f=function(){var e=Object(a.useState)("close"),t=Object(m.a)(e,2),n=t[0],r=t[1];return c.a.createElement("div",null,c.a.createElement("div",{className:"userlist "+n}," ",c.a.createElement("div",{className:"close-button",value:"x",onClick:function(){"close"===n&&r("open"),"open"===n&&r("close")}},c.a.createElement("ion-icon",{name:"exit-outline"})),c.a.createElement("div",{className:"tabbar"},c.a.createElement(u.b,{to:"/friend-list",className:"tabbutton1"},c.a.createElement("ion-icon",{name:"people-outline"})),c.a.createElement(u.b,{to:"/chat",className:"tabbutton1"},c.a.createElement("ion-icon",{name:"chatbubble-outline"})),c.a.createElement(u.b,{to:"/profile",className:"tabbutton1"},c.a.createElement("ion-icon",{name:"person-outline"})))))};var d=function(e){return c.a.createElement("div",{className:"App"},c.a.createElement("div",{className:"content"},e.children),c.a.createElement(f,null))};n(53);var v=function(e){var t=e.base64Image;return c.a.createElement("div",{className:"avatar"},c.a.createElement("img",{src:t,alt:e.name}))};n(55);var h=function(e){var t=e.text,n=Object(a.useState)(t),r=Object(m.a)(n,2),i=r[0],l=r[1];return Object(a.useEffect)(function(){!function(e){if(e.startsWith("/link"))l(c.a.createElement(u.b,{to:e},e));else if(e.startsWith("/embed")){var t=e.split(" ").slice(1).join(" ");l(c.a.createElement("div",{dangerouslySetInnerHTML:{__html:t}}))}else if(e.startsWith("/age")){var n=e.split(" "),a=Object(m.a)(n,2)[1];fetch("https://api.agify.io/?name="+a).then(function(e){return e.json()}).then(function(e){return l(e.age)})}else if(e.startsWith("/gender")){var r=e.split(" "),i=Object(m.a)(r,2)[1];fetch("https://api.genderize.io/?name="+i).then(function(e){return e.json()}).then(function(e){return l(e.gender)})}else e.startsWith("/randomfact")}(t)},[]),i};var E=function(e){var t=e.data,n=Object(a.useRef)(null);return Object(a.useEffect)(function(){n.current&&n.current.scrollIntoView()},[t]),c.a.createElement("div",{className:"chatbox"},t.map(function(e,t){return c.a.createElement("div",{ref:n,key:"".concat(e.key,"-").concat(t),className:"chatbox-item ".concat(e.position)},c.a.createElement("div",null,e.displayName),c.a.createElement(v,{name:e.displayName,base64Image:e.image}),c.a.createElement("div",{className:"chatbox-item-text"},c.a.createElement(h,{text:e.msg})))}))};n(57);var b=function(e){var t=e.value;return c.a.createElement("div",{className:"titlebar"},t)};var p=function(e){var t=Object(a.useState)(e.value||""),n=Object(m.a)(t,2),r=n[0],i=n[1];return c.a.createElement("div",{className:"inputbox"},c.a.createElement("label",{className:"label1",htmlFor:"inputmsg"},e.label),c.a.createElement("input",{id:"inputmsg",type:"text",className:"text",value:r,autoComplete:"off",onChange:function(t){i(t.target.value),e.onChange&&e.onChange(t.target.value)},onKeyPress:function(t){"Enter"===t.key&&""!==r&&(e.onEnter(r),i(""))}}),c.a.createElement("input",{type:"button",value:"Send",onClick:function(){e.onEnter(r),i("")},className:"button"}))},g=(n(31),n(5)),O=(n(28),n(33),n(11));O.a.initializeApp({apiKey:"AIzaSyBTqVSZ7AOcVM5TG8lTYhp5FzGlray7iG4",authDomain:"nobrain-ead6f.firebaseapp.com",databaseURL:"https://nobrain-ead6f-default-rtdb.asia-southeast1.firebasedatabase.app/",projectId:"nobrain-ead6f",storageBucket:"nobrain-ead6f.appspot.com",messagingSenderId:"622184282270",appId:"1:622184282270:web:aff8fb8ebc9c5f82d3e38f",measurementId:"G-8FX32GR6EH"});var j=O.a,y=function(e){return e.split("").reduce(function(e,t){return(e<<5)-e+t.charCodeAt(0)|0},0)},N=Object(a.createContext)({userList:[],chatroomList:[]});function I(e){var t=e.children,n=e.self,r=j.database().ref("users"),i=j.database().ref("chatrooms"),u=j.database().ref("images"),l=Object(a.useState)([]),f=Object(m.a)(l,2),d=f[0],v=f[1],h=Object(a.useState)({}),E=Object(m.a)(h,2),b=E[0],p=E[1],O=Object(a.useState)({}),I=Object(m.a)(O,2),C=I[0],S=I[1],k=Object(a.useState)([]),T=Object(m.a)(k,2),P=T[0],A=(T[1],function(e){return{msg:e,user:n.uid,timestamp:j.database.ServerValue.TIMESTAMP}});Object(a.useEffect)(function(){r.on("child_added",function(e){var t=function(e){return e.key!==n.uid};v(function(n){return[].concat(Object(s.a)(n.filter(t)),[Object(o.a)({},e.val(),{key:e.key})])}),p(function(t){return Object(o.a)({},t,Object(g.a)({},e.key,e.val()))})}),u.on("child_added",function(e){S(function(t){return Object(o.a)({},t,Object(g.a)({},e.key,e.val()))})}),r.on("child_removed",function(e){var t=e.key,n=function(e){return e.key!==t};v(function(e){return e.filter(n)}),p(function(e){var n=Object(o.a)({},e);return delete n[t],n})}),u.on("child_removed",function(e){S(function(t){var n=Object(o.a)({},t);return delete n[e.key],n})}),u.on("child_changed",function(e){S(function(t){return Object(o.a)({},t,Object(g.a)({},e.key,e.val()))})});var e=r.child(n.uid);return e.set({displayName:n.displayName}),e.onDisconnect().remove(),function(){r.off(),u.off()}},[]);return c.a.createElement(N.Provider,{value:{userList:d,chatroomList:P,imageDict:C,userDict:b,getUserProfile:function(e){return r.child(e).once("value").then(function(e){return e.val()})},getPrivateChat:function(e){var t="1-1-".concat(y(n.uid)+y(e));return i.child("".concat(t)).once("value").then(function(e){return e.val()})},listenToPrivateChat:function(e,t){var a="1-1-".concat(y(n.uid)+y(e));return i.child("".concat(a,"/chat")).on("child_added",function(e){e&&t(e.val())})},sendPrivateMsg:function(e,t){var a="1-1-".concat(y(n.uid)+y(t));i.child("".concat(a,"/chat")).push(A(e))},getChatroom:function(e){return i.child("".concat(e)).once("value").then(function(e){return e.val()})},listenToChatroom:function(e,t){console.log("self checkin to roomId",e);var a=i.child("".concat(e,"/users/").concat(n.uid));return a.set({displayName:n.displayName}),a.onDisconnect().remove(),i.child("".concat(e,"/chat")).on("child_added",function(e){e&&t(e.val())})},listenToUserInChatroom:function(e,t){var n=i.child("".concat(e,"/users"));return n.on("child_added",function(e){e&&t("JOINED",e.key,e.val())}),n.on("child_removed",function(e){e&&t("LEFT",e.key,e.val())}),function(){n.off("child_added"),n.off("child_removed")}},sendMsg:function(e,t){i.child("".concat(t,"/chat")).push(A(e))},setUserImage:function(e,t){var n=u.child("".concat(e));return n.set(t),n},getUserImage:function(e){return u.child("".concat(e)).once("value").then(function(e){return e.val()})}}},t)}var C=function(){return Object(a.useContext)(N)},S=n(36),k=n.n(S),T="AUTHENTICATION_LOADING",P="AUTHENTICATED",A="UNAUTHENTICATED",D=Object(a.createContext)({user:{},state:T});function w(e){var t=e.children,n=Object(a.useState)({user:void 0,state:T}),r=Object(m.a)(n,2),i=r[0],u=r[1];Object(a.useEffect)(function(){var e=j.auth().onAuthStateChanged(function(e){u({user:e,state:e?P:A})});return function(){return e()}},[]);return c.a.createElement(D.Provider,{value:{authState:i,signOut:function(){return j.auth().signOut()},signUpWithEmailAndPassword:function(e,t,n,a,c){j.auth().signUpWithEmailAndPassword(e,t,n,u,a,function(e){u(i),c&&c(e)})},signInWithEmailAndPassword:function(e,t,n,a){j.auth().signInWithEmailAndPassword(e,t,u,n,function(e){u(i),a&&a(e)})},updateDisplayName:function(e){return i.user.updateProfile({displayName:e,photoURL:i.user.photoURL})},updateEmailAddress:function(e){i.user.updateEmail(e)},sendPasswordResetEmail:function(e,t,n){return j.auth().sendPasswordResetEmail(e,t,n)},sendEmailVerification:function(e,t){return j.auth().sendEmailVerification(e,t)},userHasOnlyEmailProvider:function(){return j.auth().userHasOnlyEmailProvider()}}},t)}var U=function(){return Object(a.useContext)(D)},x={signInFlow:"popup",signInSuccessUrl:"/profile",signInOptions:[j.auth.EmailAuthProvider.PROVIDER_ID]},_=function(e){return c.a.createElement("div",null,c.a.createElement("h1",null,"GI472 PWA Chat App"),c.a.createElement("p",null,"Please sign-in:"),c.a.createElement(k.a,{uiConfig:x,firebaseAuth:j.auth()}))};var L=function(){var e=C(),t=e.sendMsg,n=e.listenToChatroom,r=e.imageDict,i=e.userDict,u=U().authState,l=Object(a.useState)([]),f=Object(m.a)(l,2),v=f[0],h=f[1];function g(e){h(function(t){return[e].concat(Object(s.a)(t))})}return Object(a.useEffect)(function(){var e=n("mainhall",g);return function(){e()}},[]),c.a.createElement(d,null,c.a.createElement("div",{className:"chat"},c.a.createElement(b,{value:"Chat"}),c.a.createElement(E,{data:v.map(function(e){var t="\u0e44\u0e21\u0e48\u0e17\u0e23\u0e32\u0e1a\u0e0a\u0e37\u0e48\u0e2d(Offline)";return e.user in i&&i[e.user].displayName?t=i[e.user].displayName:e.user===u.user.uid&&(t=u.user.displayName),Object(o.a)({},e,{key:e.timestamp||Date.now(),displayName:t,image:r[e.user]||"",position:e.user===u.user.uid?"right":"left"})}).sort(function(e,t){return e.timestamp-t.timestamp})}),c.a.createElement(p,{onEnter:function(e){return t(e,"mainhall")}})))};var W=function(){var e=Object(l.g)().uid,t=C(),n=t.getUserProfile,r=t.sendPrivateMsg,i=t.listenToPrivateChat,u=Object(a.useState)(""),f=Object(m.a)(u,2),v=f[0],h=f[1],g=Object(a.useState)([]),O=Object(m.a)(g,2),j=O[0],y=O[1],N=function(t){var n=Object(o.a)({},t,{key:t.timestamp||Date.now(),displayName:v,position:t.user===e?"right":"left"});y(function(e){return[n].concat(Object(s.a)(e))})};return Object(a.useEffect)(function(){n(e).then(function(e){return e&&h(e.displayName),e});var t=i(e,N);return function(){t()}},[e]),Object(a.useEffect)(function(){window.scrollTo(0,0)},[]),c.a.createElement(d,null,c.a.createElement("div",{className:"chat"},c.a.createElement(b,{value:v}),c.a.createElement(E,{data:j}),c.a.createElement(p,{onEnter:function(t){return r(t,e)}})))},F=(n(32),n(38)),H=n.n(F);var M=function(){var e=U(),t=e.authState,n=e.updateDisplayName,r=e.signOut,i=C(),u=i.setUserImage,l=i.getUserImage,o=Object(a.useState)(t.user.displayName),s=Object(m.a)(o,2),f=s[0],h=s[1],E=Object(a.useState)(""),b=Object(m.a)(E,2),p=b[0],g=b[1];return Object(a.useEffect)(function(){l(t.user.uid).then(function(e){g(e)})},[]),c.a.createElement(d,null,c.a.createElement("div",{className:"Profile"},c.a.createElement(v,{name:f,base64Image:p}),c.a.createElement("label",{className:"label1",htmlFor:"displayname"}),c.a.createElement("input",{id:"displayname",type:"text",className:"text",value:f,onChange:function(e){return h(e.target.value)}}),c.a.createElement(H.a,{multiple:!1,onDone:function(e){g(e.base64)}}),c.a.createElement("input",{type:"button",value:"Save",onClick:function(){n(f).then(function(e){t.user.reload(),u(t.user.uid,p)})}}),c.a.createElement("input",{type:"button",onClick:function(){return r()},value:"Sign-out"})))};n(72);var R=function(){var e=C(),t=e.userList,n=e.imageDict;return c.a.createElement(d,null,c.a.createElement("div",{className:"friend-list"},t.map(function(e){return c.a.createElement(u.b,{to:"/privatechat/".concat(e.key),key:e.key},c.a.createElement("div",{className:"friend-list-item ".concat(e.position)},c.a.createElement(v,{name:e.displayName,base64Image:n[e.key]}),c.a.createElement("div",null,e.displayName)))})))};var G=function(){var e=Object(l.g)().uid,t=C().getUserProfile,n=Object(a.useState)(""),r=Object(m.a)(n,2),i=r[0],u=r[1];return Object(a.useEffect)(function(){return t(e).then(function(e){u(e.displayName)}),function(){}},[e,t]),c.a.createElement(d,null,c.a.createElement("div",{className:"Profile"},c.a.createElement(v,{name:i}),c.a.createElement("span",null,i)))};var V=function(){var e=U().authState;return e&&"AUTHENTICATION_LOADING"===e.state?c.a.createElement("div",null,"Loading..."):e&&"AUTHENTICATED"===e.state?c.a.createElement(I,{self:e.user},c.a.createElement(u.a,null,c.a.createElement(l.c,null,c.a.createElement(l.a,{path:"/chat",element:c.a.createElement(L,null)}),c.a.createElement(l.a,{path:"/privatechat/:uid",element:c.a.createElement(W,null)}),c.a.createElement(l.a,{path:"/profile",element:c.a.createElement(M,null)}),c.a.createElement(l.a,{path:"/friend-list",element:c.a.createElement(R,null)}),c.a.createElement(l.a,{path:"/friend/:uid",element:c.a.createElement(G,null)}),c.a.createElement(l.a,{path:"/",element:c.a.createElement(M,null)})))):c.a.createElement(_,null)},z=function(e){e&&e instanceof Function&&n.e(1).then(n.bind(null,75)).then(function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)})};i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(w,null,c.a.createElement(V,null))),document.getElementById("root")),z(),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(function(e){console.log("SW registered: ",e)})}},[[40,3,2]]]);
//# sourceMappingURL=main.ea1a623a.chunk.js.map